<!DOCTYPE html>
<html ng-app='app'>
	<head>
		<link rel='stylesheet' href='vendor/bootstrap-3.3.4-dist/css/bootstrap.min.css'>
		<link rel='stylesheet' href='vendor/bootstrap-3.3.4-dist/css/bootstrap-theme.min.css'>
		<link rel='stylesheet' href='vendor/angular-xeditable/css/xeditable.css'>
		<link rel="stylesheet" href="css/admin.css">

		<script type='text/javascript' src='vendor/jquery-2.1.4.min.js'></script>
		<script type='text/javascript' src='vendor/jquery-ui-1.11.4.custom/jquery-ui.min.js'></script>
		<script type='text/javascript' src='vendor/bootstrap-3.3.4-dist/js/bootstrap.min.js'></script>
		<script type='text/javascript' src='vendor/firebase.js'></script>
		<script type='text/javascript' src='vendor/angular-1.4.8/angular.js'></script>
		<script type='text/javascript' src='vendor/angular-1.4.8/angular-route.js'></script>
		<script type='text/javascript' src='vendor/angular-1.4.8/angular-cookies.js'></script>
		<script type='text/javascript' src='vendor/moment.min.js'></script>
		<script type='text/javascript' src='vendor/moment-timezone-with-data.min.js'></script>
		<script type='text/javascript' src='vendor/bluebird.min.js'></script>
		<script type='text/javascript' src='vendor/underscore-min.js'></script>
	</head>
	<body>
		<script type='text/javascript' src='vendor/angular-moment.min.js'></script>
		<script type='text/javascript' src='vendor/angularfire.min.js'></script>
		<script type='text/javascript' src='vendor/ui-bootstrap-tpls-0.14.3.min.js'></script>
		<script type='text/javascript' src='vendor/ng-file-upload-bower-11.0.0/ng-file-upload-shim.min.js'></script>
		<script type='text/javascript' src='vendor/ng-file-upload-bower-11.0.0/ng-file-upload.min.js'></script>
		<script type='text/javascript' src='vendor/angular-xeditable/js/xeditable.min.js'></script>

		<script type='text/javascript'>
			var app = angular.module('app', ['ngRoute', 'ngCookies', 'xeditable', 'firebase', 'ui.bootstrap', 'ngFileUpload', 'angularMoment']);
			var data = JSON.parse('{"annotationTypes":{"-K6nxSSbYt6Na4tFPUVa":{"description":"Best Paper","icon":{"name":"best.png","uri":"http://localhost/~soney/confapp_admin/uploads/testcon/annotations/best.png"},"id":"best","type":"Award"},"-K6nxVqucpEHQWXpT9Dl":{"description":"Honorable Mention","icon":{"name":"honorable.png","uri":"http://localhost/~soney/confapp_admin/uploads/testcon/annotations/honorable.png"},"id":"honorable","type":"Award"}},"dataFiles":{"attachments-dot-csv":{"name":"attachments.csv","updated":1451498942701,"uri":{"name":"attachments.csv","uri":"http://localhost/~soney/confapp_admin/uploads/testcon/data/attachments.csv"}},"courses-dot-csv":{"name":"courses.csv","updated":1451498942701,"uri":{"name":"courses.csv","uri":"http://localhost/~soney/confapp_admin/uploads/testcon/data/courses.csv"}},"papers-dot-csv":{"name":"papers.csv","updated":1451498942701,"uri":{"name":"papers.csv","uri":"http://localhost/~soney/confapp_admin/uploads/testcon/data/papers.csv"}},"sessions-dot-csv":{"name":"sessions.csv","updated":1451498942701,"uri":{"name":"sessions.csv","uri":"http://localhost/~soney/confapp_admin/uploads/testcon/data/sessions.csv"}},"talks-dot-csv":{"name":"talks.csv","updated":1451499274824,"uri":{"name":"talks.csv","uri":"http://localhost/~soney/confapp_admin/uploads/testcon/data/talks.csv"}}},"description":"The First International Conference on Database Creators\' Default Settings","hasDataSync":true,"hasNotes":true,"hasReadingList":true,"hasSchedule":true,"hasVoting":false,"location":"Ann Arbor, MI","locations":{"-K6oDlySFjjVb7EkSa9_":{"id":"oval","mapKey":"-K6oCU3nm4DV-42pLAGU","name":"Oval Room","pctX":0.49364791288566245,"pctY":0.6657608695652174},"-K6oDomBaxUSBGZ2HX88":{"id":"red","mapKey":"-K6oBzsTMhyrDh94YBRQ","name":"Red Room","pctX":0.3466424682395644,"pctY":0.6094182825484764},"-K6oDqIkikFYTkWaKzOY":{"id":"blue","mapKey":"-K6oBzsTMhyrDh94YBRQ","name":"Blue Room","pctX":0.5009074410163339,"pctY":0.6565096952908587},"-K6oDrpHy4uAHZzeMLq0":{"id":"green","mapKey":"-K6oBzsTMhyrDh94YBRQ","name":"Green Room","pctX":0.6612612612612613,"pctY":0.6043956043956044}},"maps":{"-K6oBzsTMhyrDh94YBRQ":{"id":"floor_1","image":{"name":"floor_1.png","uri":"http://localhost/~soney/confapp_admin/uploads/testcon/maps/floor_1.png"},"name":"Floor 1"},"-K6oCU3nm4DV-42pLAGU":{"id":"floor_2","image":{"name":"floor_2.png","uri":"http://localhost/~soney/confapp_admin/uploads/testcon/maps/floor_2.png"},"name":"Floor 2"}},"name":"Default Conference 2016","presentationTypes":{"-K6oCjmxOzJiGpex5dCr":{"duration":"20","name":"Paper","personDemonym":"Author"},"-K6oCmGAQ-Y6ziyo0PPw":{"duration":"15","name":"Note","personDemonym":"Author"}},"primaryIcon":{"name":"defaultConferenceIcon.png","uri":"http://localhost/~soney/admin_confapp_com/uploads/testcon/icons/defaultConferenceIcon.png"},"primaryIconURI":{"uri":"http://localhost/~soney/admin_confapp_com/uploads/testcon/icons/icon_idle.png"},"sessionTypes":{"-K6oCqzrm1aytrabGvDu":{"eventDemonym":"Papers","name":"Papers","personDemonym":"Chair"},"-K6oCtlpbTgFPWaodPQD":{"eventDemonym":"","name":"Course","personDemonym":"Instructor"}},"timeZone":"America/New_York","uid":"testcon","webBaseURL":"http://confapp.github.io/web_guide/?conference=testcon"}');

			app.run(function(DatabaseCreator) {
				DatabaseCreator.createDatabase(data).then(function(result) {
					if(result.warnings.length > 0) {
						$('<h2>Warnings</h2>').appendTo(document.body);
					}
					_.each(result.warnings, function(warning) {
						$('<div />').text(warning.message).appendTo(document.body);
					});
					console.log(result);
					var db = result.database;
					var result = db.exec("SELECT name FROM sqlite_master WHERE type='table'")
					var tables = [];
					_.each(result[0].values, function(val) {
						tables.push(val[0]);
					});

					_.each(tables, function(tableName) {
						var row = $('<div />').css('padding-left', '50px').appendTo(document.body)
						var header = $('<h2 />').text(tableName).appendTo(row);
						var structure = toObject(db.exec("pragma table_info("+tableName+")")[0]);
						var table = $('<table />').appendTo(row);
						var tbody = $('<tbody />').appendTo(table);
						var header = $('<tr />').appendTo(tbody);
						_.each(structure, function(column) {
							$('<td />').css({
								'font-weight': 'bold'
							}).text(column.name).appendTo(header);
						})
						var entries = db.exec("SELECT * FROM "+tableName+"")[0];
						if(entries) {
							_.each(entries.values, function(entry) {
								var row = $('<tr />').appendTo(tbody);
								_.each(entry, function(val) {
									$('<td />').text(val).appendTo(row);
								});
							});
						}
					});

					function toObject(result) {
						var rv = [];
						var columns = result.columns;
						_.each(result.values, function(value) {
							var obj = {};
							_.each(columns, function(colName, index) {
								obj[colName] = value[index]
							});
							rv.push(obj);
						});
						return rv;
					}
				});
			});
		</script>
		<!--<script type='text/javascript' src='js/main.js'></script>
		<script type='text/javascript' src='js/auth.js'></script>-->
		<script type='text/javascript' src='login/login.controller.js'></script>
		<script type='text/javascript' src='choose_conference/choose_conference.controller.js'></script>
		<script type='text/javascript' src='confapp_admin_home/admin.controller.js'></script>
		<script type='text/javascript' src='db_creator/db_creator_interface.js'></script>
		<script type='text/javascript' src='db_creator/create_tables.js'></script>
		<script type='text/javascript' src='db_creator/data_types.js'></script>
		<script type='text/javascript' src='db_creator/warnings.js'></script>
		<script type='text/javascript' src='db_creator/sqlite_to_json.js'></script>
		<script type='text/javascript' src='db_creator/spreadsheet/csv_headers.js'></script>
		<script type='text/javascript' src='db_creator/spreadsheet/determine_csv_type.js'></script>
		<script type='text/javascript' src='db_creator/spreadsheet/read_csv.js'></script>
		<script type='text/javascript' src='db_creator/spreadsheet/csv_papers_reader.js'></script>
		<script type='text/javascript' src='db_creator/spreadsheet/csv_sessions_reader.js'></script>
		<script type='text/javascript' src='db_creator/spreadsheet/csv_attachments_reader.js'></script>

		<script type='text/javascript' src='vendor/sql.js'></script>
		<script type='text/javascript' src='vendor/PapaParse-4.1.2/papaparse.min.js'></script>

	</body>
</html>